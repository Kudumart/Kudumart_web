import EmojiPicker from "emoji-picker-react";
import { useEffect, useState } from "react";
import { CloseIcon, EmojiIcon } from "../../../../svg";

export default function EmojiPickerApp({
  textRef,
  message,
  setMessage,
  showPicker,
  setShowPicker,
  setShowAttachments,
}) {
  const [cursorPosition, setCursorPosition] = useState();
  useEffect(() => {
    textRef.current.selectionEnd = cursorPosition;
  }, [cursorPosition]);
  const handleEmoji = (emojiData, e) => {
    const { emoji } = emojiData;
    const ref = textRef.current;
    ref.focus();
    const start = message.substring(0, ref.selectionStart);
    const end = message.substring(ref.selectionStart);
    const newText = start + emoji + end;
    setMessage(newText);
    setCursorPosition(start.length + emoji.length);
  };
  return (
    <div className="w-fit h-fit mt-2">
      <button
        // className="btn"
        type="button"
        onClick={() => {
          setShowAttachments(false);
          setShowPicker((prev) => !prev);
        }}
      >
        {showPicker ? (
          <CloseIcon className="dark:fill-dark_svg_1" />
        ) : (
          <svg
            width="15"
            height="18"
            viewBox="0 0 20 21"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M10.0161 0.574341C8.07607 0.574341 6.17958 1.14963 4.56649 2.22747C2.95339 3.30531 1.69614 4.83728 0.953708 6.62965C0.211281 8.42203 0.0170287 10.3943 0.395515 12.2971C0.774001 14.1999 1.70823 15.9477 3.08005 17.3195C4.45188 18.6913 6.19969 19.6256 8.10247 20.004C10.0052 20.3825 11.9775 20.1883 13.7699 19.4458C15.5623 18.7034 17.0942 17.4462 18.1721 15.8331C19.2499 14.22 19.8252 12.3235 19.8252 10.3834C19.8225 7.78274 18.7881 5.28936 16.9492 3.45039C15.1102 1.61142 12.6168 0.577087 10.0161 0.574341ZM10.0161 18.6834C8.37454 18.6834 6.76982 18.1966 5.40489 17.2846C4.03997 16.3726 2.97613 15.0763 2.34793 13.5597C1.71972 12.0431 1.55535 10.3742 1.87561 8.76418C2.19587 7.15414 2.98636 5.67522 4.14714 4.51445C5.30792 3.35367 6.78683 2.56317 8.39688 2.24291C10.0069 1.92266 11.6758 2.08702 13.1924 2.71523C14.709 3.34344 16.0053 4.40727 16.9173 5.7722C17.8293 7.13713 18.3161 8.74185 18.3161 10.3834C18.3136 12.584 17.4384 14.6936 15.8824 16.2497C14.3263 17.8057 12.2167 18.6809 10.0161 18.6834ZM5.48885 8.49707C5.48885 8.27321 5.55523 8.05439 5.6796 7.86826C5.80396 7.68214 5.98073 7.53707 6.18754 7.4514C6.39436 7.36574 6.62193 7.34333 6.84148 7.387C7.06103 7.43067 7.2627 7.53846 7.42099 7.69675C7.57928 7.85504 7.68707 8.05671 7.73074 8.27626C7.77441 8.49581 7.752 8.72338 7.66634 8.9302C7.58067 9.13701 7.4356 9.31377 7.24948 9.43814C7.06335 9.56251 6.84452 9.62889 6.62067 9.62889C6.32049 9.62889 6.03261 9.50964 5.82035 9.29738C5.6081 9.08513 5.48885 8.79724 5.48885 8.49707ZM14.5434 8.49707C14.5434 8.72092 14.477 8.93974 14.3527 9.12587C14.2283 9.312 14.0515 9.45707 13.8447 9.54273C13.6379 9.6284 13.4103 9.65081 13.1908 9.60714C12.9712 9.56347 12.7696 9.45567 12.6113 9.29738C12.453 9.1391 12.3452 8.93743 12.3015 8.71787C12.2578 8.49832 12.2803 8.27075 12.3659 8.06394C12.4516 7.85713 12.5966 7.68036 12.7828 7.55599C12.9689 7.43163 13.1877 7.36525 13.4116 7.36525C13.7118 7.36525 13.9996 7.48449 14.2119 7.69675C14.4242 7.90901 14.5434 8.19689 14.5434 8.49707ZM14.4425 13.0243C13.4719 14.7023 11.8582 15.6652 10.0161 15.6652C8.17409 15.6652 6.56125 14.7032 5.59072 13.0243C5.53612 12.9385 5.49946 12.8424 5.48295 12.742C5.46643 12.6416 5.4704 12.5389 5.49461 12.44C5.51882 12.3412 5.56278 12.2483 5.62383 12.1668C5.68488 12.0854 5.76178 12.0172 5.84988 11.9663C5.93799 11.9154 6.03548 11.8828 6.1365 11.8705C6.23753 11.8582 6.33999 11.8665 6.43772 11.8949C6.53546 11.9232 6.62645 11.9711 6.70522 12.0355C6.78399 12.0999 6.84891 12.1796 6.89608 12.2698C7.60064 13.4874 8.70793 14.1562 10.0161 14.1562C11.3243 14.1562 12.4316 13.4865 13.1352 12.2698C13.2353 12.0964 13.4001 11.9699 13.5934 11.9181C13.7868 11.8663 13.9928 11.8934 14.1661 11.9934C14.3395 12.0935 14.466 12.2583 14.5178 12.4517C14.5696 12.645 14.5425 12.851 14.4425 13.0243Z"
              fill="black"
            />
          </svg>
        )}
      </button>
      {/*Emoji picker*/}
      {showPicker ? (
        <div className="openEmojiAnimation absolute bottom-[60px] left-[-0.5px] w-full">
          <EmojiPicker theme="dark" onEmojiClick={handleEmoji} />
        </div>
      ) : null}
    </div>
  );
}
